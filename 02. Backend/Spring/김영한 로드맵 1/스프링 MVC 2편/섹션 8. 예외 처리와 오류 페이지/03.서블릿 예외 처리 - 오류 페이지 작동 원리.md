# 서블릿 예외 처리 - 오류 페이지 작동 원리
서블릿은 `Exception`이 발생해서 서블릿 밖으로 전달되거나 `response.sendError()`가 호출됐을 때 설정된 오류 페이지를 찾는다.

### 예외 발생 흐름
```
WAS(여기까지 전파) <- 필터 <- 서블릿 <- 인터셉터 <- 컨트롤러(예외발생)
```

### sendError 흐름
```
WAS(sendError 호출 기록 확인) <- 필터 <- 서블릿 <- 인터셉터 <- 컨트롤러(response.sendError())
```

WAS는 해당 예외를 처리하는 오류 페이지 정보를 확인한다.
- 해당 예외를 처리하는 오류 페이지 정보 : `new ErrorPage(RuntimException.class, "/error-page/500")`

예를 들어서 `RuntimeException`이 WAS까지 전달되면 WAS는 오류 페이지 정보를 확인한다. 확인해보니 `error-page/500`이 지정되어 있다. 따라서 WAS는 오류 페이지를 출력하기 위해 **`/error-page/500`를 다시 요청한다.**


### 오류 페이지 요청 흐름
```
WAS "/error-page/500" 다시 요청 -> 필터 -> 서블릿 -> 인터셉터 -> 컨트롤러("/error-page/500") -> 뷰
```
**실제로 HTTP 요청을 다시 보내는 건 아니고, 서버 내부적으로 저 path를 다시 호출하는 것뿐이다.**


### [정리]
#### 1. 예외 발생과 오류 페이지 요청 흐름
```
1) WAS(여기까지 전파) <- 필터 <- 서블릿 <- 인터셉터 <- 컨트롤러(예외발생)
2) WAS "/error-page/500" 다시 요청 -> 필터 -> 서블릿 -> 인터셉터 -> 컨트롤러("/error-page/500") -> 뷰 
```
1) 예외가 발생해서 WAS까지 전파되고
2) WAS는 오류 페이지 경로를 찾은 뒤 오류 페이지를 호출한다. 
이때 오류 페이지 경로로 필터, 서블릿, 인터셉터, 컨트롤러가 모두 다시 호출된다. 
(★필터와 인터셉터가 다시 호출되는 부분은 이후 강의에서 더 자세히 설명)

#### 2. 오류 정보 추가
WAS가 오류 페이지를 다시 요청할 때 오류 정보를 `request`의 `attribute`에 추가해서 넘겨준다. 따라서 이를 사용할 수도 있다.